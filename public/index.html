<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<link rel="stylesheet" type="text/css" href="app.css">
		<link href='http://fonts.googleapis.com/css?family=Lora|Oswald' rel='stylesheet' type='text/css'>
		
		<script>
			window.onload = function() {
				var socket = io.connect('http://localhost:5000');
				
				socket.on('connect', function(){
					console.log("Connection made");
				});
				
				socket.on('photos', function (data) {
					console.log('got some data back');
					$.each(data,function(){
						postPhoto(this);
					});
				});
				
				socket.on('new', function (data) {
					console.log('got a new photo');
					postPhoto(data);
				});
				
				socket.on('done', function () {
					$('#next').remove();
				});
				
				$("#next").click(function(){
					console.log('asking for new photos')
					socket.emit('next');
				});
				
				postPhoto = function(data,direction){
					url = data.images.low_resolution.url;
					caption = '';
					if (data.caption !== null) {
						caption = data.caption.text;
					}
					user = data.user.username
					link = data.link;
					var photoCode = createPhoto(url, caption, user , link);
					if (direction){
						$('#photodiv').prepend(photoCode);
					} else {
						$('#photodiv').append(photoCode);
					}
				}
				
				createPhoto = function(url,caption,user,link){
					img = '<a href="'+link+'"><img src="'+url+'" /></a>';
					cap = '<div class="caption">'+caption+'</div>';
					userCode = '<div class="user">by: <a href="http://instagram.com/'+user+'">'+user+'</a></div>';
					return '<div class="image">'+img+userCode+cap+'</div>';
				}
			}
			
		</script>
	</head>
	<body>
		<div id="header">
			<div id="head">What #SalemIs in One Image</div>
			<div id="subhead">Real-time look at Instagram photos tagged #salemis. Powered by SalemIs, Be and you. Not monitored. Be nice, Salem.</div>
			<input type="button" id="next" value="Get more photos">
		</div>
		<div id="photodiv"></div>
	</body>
</html>